// Code generated by goa v3.24.1, DO NOT EDIT.
//
// ingest HTTP client CLI support package
//
// Command:
// $ goa gen github.com/aditnikel/grapgraph/design

package client

import (
	"encoding/json"
	"fmt"

	ingest "github.com/aditnikel/grapgraph/gen/ingest"
	goa "goa.design/goa/v3/pkg"
)

// BuildPostEventPayload builds the payload for the ingest post_event endpoint
// from CLI flags.
func BuildPostEventPayload(ingestPostEventBody string) (*ingest.BulkCustomerEvents, error) {
	var err error
	var body PostEventRequestBody
	{
		err = json.Unmarshal([]byte(ingestPostEventBody), &body)
		if err != nil {
			return nil, fmt.Errorf("invalid JSON for body, \nerror: %s, \nexample of valid JSON:\n%s", err, "'{\n      \"events\": [\n         {\n            \"event_timestamp\": \"2024-03-20T10:00:00Z\",\n            \"event_type\": \"PAYMENT\",\n            \"merchant_id_mpan\": \"m_7\",\n            \"total_transaction_amount\": 125,\n            \"user_id\": \"u_1\"\n         },\n         {\n            \"event_timestamp\": 1710930030000,\n            \"event_type\": \"LOGIN\",\n            \"user_id\": \"u_2\"\n         }\n      ]\n   }'")
		}
		if body.Events == nil {
			err = goa.MergeErrors(err, goa.MissingFieldError("events", "body"))
		}
		if len(body.Events) < 1 {
			err = goa.MergeErrors(err, goa.InvalidLengthError("body.events", body.Events, len(body.Events), 1, true))
		}
		for _, e := range body.Events {
			if e != nil {
				if err2 := ValidateCustomerEventRequestBody(e); err2 != nil {
					err = goa.MergeErrors(err, err2)
				}
			}
		}
		if err != nil {
			return nil, err
		}
	}
	v := &ingest.BulkCustomerEvents{}
	if body.Events != nil {
		v.Events = make([]*ingest.CustomerEvent, len(body.Events))
		for i, val := range body.Events {
			if val == nil {
				v.Events[i] = nil
				continue
			}
			v.Events[i] = marshalCustomerEventRequestBodyToIngestCustomerEvent(val)
		}
	} else {
		v.Events = []*ingest.CustomerEvent{}
	}

	return v, nil
}
