openapi: 3.0.3
info:
    title: Grapgraph API
    description: High-performance fraud detection and financial network analysis platform built with Goa and FalkorDB.
    version: 0.0.1
servers:
    - url: http://localhost:8080
paths:
    /:
        get:
            tags:
                - openapi
            summary: index openapi
            description: Provides a simple landing page.
            operationId: openapi#index
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Ea ut nulla voluptate inventore.
                            example: Nihil consequuntur laudantium.
    /docs:
        get:
            tags:
                - openapi
            summary: docs openapi
            description: Serves the interactive Swagger UI.
            operationId: openapi#docs
            responses:
                "200":
                    description: OK response.
                    content:
                        text/html:
                            schema:
                                type: string
                                example: Error alias.
                            example: Velit odit voluptas ab modi tempore.
    /healthz:
        get:
            tags:
                - health
            summary: get health
            description: Returns the health status of the API and its underlying graph database.
            operationId: health#get
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/HealthResponse'
                            example:
                                error: Database connection failed
                                ok: true
                "503":
                    description: Service Unavailable response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/HealthResponse'
                            example:
                                error: Database connection failed
                                ok: true
    /openapi.json:
        get:
            tags:
                - openapi
            summary: Download gen/http/openapi3.json
            operationId: openapi#/openapi.json
            responses:
                "200":
                    description: File downloaded
    /v1/graph/metadata:
        get:
            tags:
                - graph
            summary: get_metadata graph
            description: Returns valid node types, edge types, and supported ranking metrics.
            operationId: graph#get_metadata
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/MetadataResponse'
                            example:
                                edge_types:
                                    - PAYMENT
                                    - LOGIN
                                    - WITHDRAWAL
                                node_types:
                                    - USER
                                    - MERCHANT
                                    - DEVICE
    /v1/graph/subgraph:
        post:
            tags:
                - graph
            summary: post_subgraph graph
            description: Extracts a surrounding subgraph for a specific root node using multi-hop analysis.
            operationId: graph#post_subgraph
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/SubgraphRequest'
                        example:
                            edge_types:
                                - PAYMENT
                                - LOGIN
                            hops: 2
                            limit:
                                max_edges: 100
                                max_nodes: 50
                            root:
                                key: u_123
                                type: USER
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/SubgraphResponse'
                            example:
                                edges:
                                    - directed: true
                                      from: USER:u_123
                                      id: e123
                                      to: MERCHANT:m_777
                                      type: PAYMENT
                                    - directed: true
                                      from: USER:u_123
                                      id: e123
                                      to: MERCHANT:m_777
                                      type: PAYMENT
                                nodes:
                                    - id: USER:u_123
                                      key: u_123
                                      label: User u_123
                                      props:
                                        Aut pariatur incidunt assumenda maxime perferendis.: Tempore perferendis dolores voluptatibus rem.
                                        Expedita pariatur quia labore sapiente.: Odio laudantium ut et nulla rerum maxime.
                                      type: USER
                                    - id: USER:u_123
                                      key: u_123
                                      label: User u_123
                                      props:
                                        Aut pariatur incidunt assumenda maxime perferendis.: Tempore perferendis dolores voluptatibus rem.
                                        Expedita pariatur quia labore sapiente.: Odio laudantium ut et nulla rerum maxime.
                                      type: USER
                                root: USER:u_123
                                truncated: false
                                version: "1.0"
                "400":
                    description: 'bad_request: Bad Request response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Et est et placeat harum omnis.
                            example: Maiores amet soluta repellat.
    /v1/ingest/event:
        post:
            tags:
                - ingest
            summary: post_event ingest
            description: Accepts one or more financial events (Payment, Login, etc.) and updates the relationship graph.
            operationId: ingest#post_event
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/BulkCustomerEvents'
                        example:
                            events:
                                - event_timestamp: "2024-03-20T10:00:00Z"
                                  event_type: PAYMENT
                                  merchant_id_mpan: m_7
                                  total_transaction_amount: 125
                                  user_id: u_1
                                - event_timestamp: 1710930030000
                                  event_type: LOGIN
                                  user_id: u_2
            responses:
                "202":
                    description: Accepted response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/BulkIngestResponse'
                            example:
                                accepted: true
                                accepted_count: 3
                                failed_count: 0
                "400":
                    description: 'bad_request: Bad Request response.'
                    content:
                        application/json:
                            schema:
                                type: string
                                example: Ipsa laboriosam error hic autem placeat itaque.
                            example: Sit quod numquam dolores earum quis.
components:
    schemas:
        BulkCustomerEvents:
            type: object
            properties:
                events:
                    type: array
                    items:
                        $ref: '#/components/schemas/CustomerEvent'
                    description: List of events to ingest in-order.
                    example:
                        - event_timestamp: "2024-03-20T10:00:00Z"
                          event_type: PAYMENT
                          merchant_id_mpan: m_7
                          total_transaction_amount: 125
                          user_id: u_1
                        - event_timestamp: 1710930030000
                          event_type: LOGIN
                          user_id: u_2
                    minItems: 1
            description: Batch of financial events for ingestion.
            example:
                events:
                    - event_timestamp: "2024-03-20T10:00:00Z"
                      event_type: PAYMENT
                      merchant_id_mpan: m_7
                      total_transaction_amount: 125
                      user_id: u_1
                    - event_timestamp: 1710930030000
                      event_type: LOGIN
                      user_id: u_2
            required:
                - events
        BulkIngestResponse:
            type: object
            properties:
                accepted:
                    type: boolean
                    description: Whether all events were processed successfully.
                    example: true
                accepted_count:
                    type: integer
                    description: Number of events accepted in this batch.
                    example: 3
                    format: int64
                failed_count:
                    type: integer
                    description: Number of events rejected in this batch.
                    example: 0
                    format: int64
            description: Result of the bulk ingestion attempt.
            example:
                accepted: true
                accepted_count: 3
                failed_count: 0
            required:
                - accepted
                - accepted_count
                - failed_count
        CustomerEvent:
            type: object
            properties:
                device_id:
                    type: string
                    description: Unique hardware ID where the activity originated.
                    example: d_888
                event_timestamp:
                    description: Timestamp of the activity (RFC3339 string or Epoch MS).
                    example: "2024-03-20T10:00:00Z"
                event_type:
                    type: string
                    description: The type of event (PAYMENT, LOGIN, WITHDRAWAL, etc).
                    example: PAYMENT
                exchange:
                    type: string
                    description: Crypto exchange name if applicable.
                    example: BINANCE
                ip_address:
                    type: string
                    description: Remote IP address (not stored directly in graph).
                    example: 192.168.1.1
                issuing_bank:
                    type: string
                    description: The bank that issued the instrument.
                    example: JP_MORGAN
                merchant_id_mpan:
                    type: string
                    description: Target merchant ID or card MPAN.
                    example: m_777
                payment_method:
                    type: string
                    description: Method used (VISA, CRYPTO, etc).
                    example: VISA
                total_transaction_amount:
                    type: number
                    description: Monetary value of the transaction.
                    example: 150.5
                    format: double
                user_id:
                    type: string
                    description: Unique identifier of the user (e.g. u_123).
                    example: u_123
                wallet_address:
                    type: string
                    description: Blockchain wallet address if applicable.
                    example: "0xabc123"
            description: Information about a financial activity or user action.
            example:
                device_id: d_888
                event_timestamp: "2024-03-20T10:00:00Z"
                event_type: PAYMENT
                exchange: BINANCE
                ip_address: 192.168.1.1
                issuing_bank: JP_MORGAN
                merchant_id_mpan: m_777
                payment_method: VISA
                total_transaction_amount: 150.5
                user_id: u_123
                wallet_address: "0xabc123"
            required:
                - user_id
                - event_type
                - event_timestamp
        GraphEdge:
            type: object
            properties:
                directed:
                    type: boolean
                    description: Whether the relationship has a specific flow direction.
                    example: true
                from:
                    type: string
                    description: ID of the source node.
                    example: USER:u_123
                id:
                    type: string
                    description: Unique ID for the specific relationship.
                    example: e123
                to:
                    type: string
                    description: ID of the target node.
                    example: MERCHANT:m_777
                type:
                    type: string
                    description: The type of connection (e.g. PAYMENT).
                    example: PAYMENT
            description: A relationship between two entities.
            example:
                directed: true
                from: USER:u_123
                id: e123
                to: MERCHANT:m_777
                type: PAYMENT
            required:
                - id
                - type
                - from
                - to
                - directed
        GraphNode:
            type: object
            properties:
                id:
                    type: string
                    description: Stable ID generated for visualization.
                    example: USER:u_123
                key:
                    type: string
                    description: The domain-specific key (e.g. u_123).
                    example: u_123
                label:
                    type: string
                    description: Human-friendly display name.
                    example: User u_123
                props:
                    type: object
                    description: Additional key-value properties.
                    example:
                        Et hic veniam aut.: Possimus consequatur velit ea.
                        Odit rerum.: Saepe enim aliquid accusamus accusantium.
                        Quis nam eum dolorum iure nobis.: Doloremque quia quaerat sed eum consequuntur dicta.
                    additionalProperties: true
                type:
                    type: string
                    description: The category of the entity.
                    example: USER
            description: A single entity (User, Merchant, Device) in the resulting subgraph.
            example:
                id: USER:u_123
                key: u_123
                label: User u_123
                props:
                    Id sunt rem.: Asperiores deserunt iusto.
                    Nemo vel odio qui.: Et quo consectetur.
                    Provident facere sapiente.: Qui natus ut autem possimus.
                type: USER
            required:
                - id
                - type
                - key
                - label
        HealthResponse:
            type: object
            properties:
                error:
                    type: string
                    description: Error message if the service is unhealthy.
                    example: Database connection failed
                ok:
                    type: boolean
                    description: Whether the service is fully operational.
                    example: true
            description: Health status of the system components.
            example:
                error: Database connection failed
                ok: true
            required:
                - ok
        IngestResponse:
            type: object
            properties:
                accepted:
                    type: boolean
                    description: Whether the event was successfully queued or processed.
                    example: true
            description: Result of the event ingestion attempt.
            example:
                accepted: true
            required:
                - accepted
        MetadataResponse:
            type: object
            properties:
                edge_types:
                    type: array
                    items:
                        type: string
                        example: Quia vel et porro incidunt.
                    description: All valid event types.
                    example:
                        - PAYMENT
                        - LOGIN
                        - WITHDRAWAL
                node_types:
                    type: array
                    items:
                        type: string
                        example: Minima est aut.
                    description: All valid entity types.
                    example:
                        - USER
                        - MERCHANT
                        - DEVICE
            description: Supported constants and schema definitions for the current system.
            example:
                edge_types:
                    - PAYMENT
                    - LOGIN
                    - WITHDRAWAL
                node_types:
                    - USER
                    - MERCHANT
                    - DEVICE
            required:
                - node_types
                - edge_types
        SubgraphRequest:
            type: object
            properties:
                edge_types:
                    type: array
                    items:
                        type: string
                        example: Ab iusto quasi doloremque et atque sit.
                    description: Filter to only include these relationship types.
                    example:
                        - PAYMENT
                        - LOGIN
                hops:
                    type: integer
                    description: Number of hops to traverse (1-3).
                    default: 2
                    example: 2
                    format: int64
                    minimum: 1
                    maximum: 3
                limit:
                    type: object
                    properties:
                        max_edges:
                            type: integer
                            description: Maximum number of edges to return.
                            default: 200
                            example: 100
                            format: int64
                        max_nodes:
                            type: integer
                            description: Maximum number of nodes to return.
                            default: 100
                            example: 50
                            format: int64
                    description: Resource budget for the response.
                    example:
                        max_edges: 100
                        max_nodes: 50
                    required:
                        - max_nodes
                        - max_edges
                root:
                    type: object
                    properties:
                        key:
                            type: string
                            description: The unique key of the root node.
                            example: u_123
                        type:
                            type: string
                            description: Type of the root node (usually USER).
                            example: USER
                    description: The starting node for the traversal.
                    example:
                        key: u_123
                        type: USER
                    required:
                        - type
                        - key
            description: Parameters for extracting a localized network subgraph.
            example:
                edge_types:
                    - PAYMENT
                    - LOGIN
                hops: 2
                limit:
                    max_edges: 100
                    max_nodes: 50
                root:
                    key: u_123
                    type: USER
            required:
                - root
                - limit
        SubgraphResponse:
            type: object
            properties:
                edges:
                    type: array
                    items:
                        $ref: '#/components/schemas/GraphEdge'
                    description: List of all connections found.
                    example:
                        - directed: true
                          from: USER:u_123
                          id: e123
                          to: MERCHANT:m_777
                          type: PAYMENT
                        - directed: true
                          from: USER:u_123
                          id: e123
                          to: MERCHANT:m_777
                          type: PAYMENT
                nodes:
                    type: array
                    items:
                        $ref: '#/components/schemas/GraphNode'
                    description: List of all entities in the network.
                    example:
                        - id: USER:u_123
                          key: u_123
                          label: User u_123
                          props:
                            Et et eum eaque.: Voluptatem earum consectetur iste.
                            Quaerat officia hic mollitia quae deserunt.: Soluta minima non.
                            Qui quo dicta.: Aut quis iste nemo ut quisquam aspernatur.
                          type: USER
                        - id: USER:u_123
                          key: u_123
                          label: User u_123
                          props:
                            Et et eum eaque.: Voluptatem earum consectetur iste.
                            Quaerat officia hic mollitia quae deserunt.: Soluta minima non.
                            Qui quo dicta.: Aut quis iste nemo ut quisquam aspernatur.
                          type: USER
                root:
                    type: string
                    description: The ID of the requested starting node.
                    example: USER:u_123
                truncated:
                    type: boolean
                    description: Indicates if the result was clipped by performance budgets.
                    example: false
                version:
                    type: string
                    description: Format version of the response.
                    example: "1.0"
            description: Result of the graph traversal containing the extracted network.
            example:
                edges:
                    - directed: true
                      from: USER:u_123
                      id: e123
                      to: MERCHANT:m_777
                      type: PAYMENT
                    - directed: true
                      from: USER:u_123
                      id: e123
                      to: MERCHANT:m_777
                      type: PAYMENT
                    - directed: true
                      from: USER:u_123
                      id: e123
                      to: MERCHANT:m_777
                      type: PAYMENT
                    - directed: true
                      from: USER:u_123
                      id: e123
                      to: MERCHANT:m_777
                      type: PAYMENT
                nodes:
                    - id: USER:u_123
                      key: u_123
                      label: User u_123
                      props:
                        Et et eum eaque.: Voluptatem earum consectetur iste.
                        Quaerat officia hic mollitia quae deserunt.: Soluta minima non.
                        Qui quo dicta.: Aut quis iste nemo ut quisquam aspernatur.
                      type: USER
                    - id: USER:u_123
                      key: u_123
                      label: User u_123
                      props:
                        Et et eum eaque.: Voluptatem earum consectetur iste.
                        Quaerat officia hic mollitia quae deserunt.: Soluta minima non.
                        Qui quo dicta.: Aut quis iste nemo ut quisquam aspernatur.
                      type: USER
                    - id: USER:u_123
                      key: u_123
                      label: User u_123
                      props:
                        Et et eum eaque.: Voluptatem earum consectetur iste.
                        Quaerat officia hic mollitia quae deserunt.: Soluta minima non.
                        Qui quo dicta.: Aut quis iste nemo ut quisquam aspernatur.
                      type: USER
                    - id: USER:u_123
                      key: u_123
                      label: User u_123
                      props:
                        Et et eum eaque.: Voluptatem earum consectetur iste.
                        Quaerat officia hic mollitia quae deserunt.: Soluta minima non.
                        Qui quo dicta.: Aut quis iste nemo ut quisquam aspernatur.
                      type: USER
                root: USER:u_123
                truncated: false
                version: "1.0"
            required:
                - version
                - root
                - nodes
                - edges
                - truncated
tags:
    - name: openapi
      description: The openapi service serves the OpenAPI specification and interactive documentation.
    - name: health
      description: Health check service for monitoring service and database connectivity.
    - name: ingest
      description: High-speed financial event ingestion service.
    - name: graph
      description: Graph traversal service for fraud pattern analysis and subgraph extraction.
